<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Aztec Private Swaps</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Orbitron", sans-serif;
                background: linear-gradient(
                    135deg,
                    #0a0a0a 0%,
                    #1a0a2e 50%,
                    #16003e 100%
                );
                color: #00ffff;
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
                position: relative;
                overflow: hidden;
            }

            body::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 0, 255, 0.03) 2px,
                    rgba(255, 0, 255, 0.03) 4px
                );
                pointer-events: none;
                z-index: 1;
            }

            .container {
                max-width: 600px;
                width: 100%;
                background: rgba(10, 10, 30, 0.8);
                border: 2px solid #ff00ff;
                border-radius: 15px;
                padding: 40px;
                box-shadow:
                    0 0 20px rgba(255, 0, 255, 0.5),
                    0 0 40px rgba(0, 255, 255, 0.3),
                    inset 0 0 20px rgba(255, 0, 255, 0.1);
                position: relative;
                z-index: 2;
            }

            h1 {
                text-align: center;
                font-size: 2.5em;
                margin-bottom: 30px;
                text-shadow:
                    0 0 10px #ff00ff,
                    0 0 20px #ff00ff,
                    0 0 30px #00ffff;
                animation: glow 2s ease-in-out infinite alternate;
            }

            @keyframes glow {
                from {
                    text-shadow:
                        0 0 10px #ff00ff,
                        0 0 20px #ff00ff,
                        0 0 30px #00ffff;
                }
                to {
                    text-shadow:
                        0 0 20px #ff00ff,
                        0 0 30px #ff00ff,
                        0 0 40px #00ffff,
                        0 0 50px #00ffff;
                }
            }

            .balance-section {
                background: rgba(0, 255, 255, 0.05);
                border: 1px solid #00ffff;
                border-radius: 10px;
                padding: 25px;
                margin-bottom: 30px;
                text-align: center;
            }

            .balance-label {
                font-size: 1.2em;
                color: #00ffff;
                margin-bottom: 10px;
            }

            .balance-value {
                font-size: 2.5em;
                color: #ff00ff;
                font-weight: 900;
                text-shadow: 0 0 10px #ff00ff;
            }

            .deploy-section {
                background: rgba(255, 0, 255, 0.05);
                border: 1px solid #ff00ff;
                border-radius: 10px;
                padding: 25px;
                margin-bottom: 20px;
            }

            .input-group {
                margin-bottom: 20px;
            }

            .input-group label {
                display: block;
                margin-bottom: 8px;
                color: #00ffff;
                font-size: 0.9em;
            }

            .input-group input {
                width: 100%;
                padding: 12px;
                background: rgba(0, 0, 0, 0.5);
                border: 1px solid #00ffff;
                border-radius: 5px;
                color: #00ffff;
                font-family: "Orbitron", sans-serif;
                font-size: 1em;
            }

            .input-group input:focus {
                outline: none;
                border-color: #ff00ff;
                box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
            }

            button {
                width: 100%;
                padding: 15px;
                background: linear-gradient(135deg, #ff00ff 0%, #00ffff 100%);
                border: none;
                border-radius: 8px;
                color: #000;
                font-family: "Orbitron", sans-serif;
                font-size: 1.1em;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 2px;
                box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            }

            button:hover {
                transform: translateY(-2px);
                box-shadow:
                    0 0 30px rgba(255, 0, 255, 0.8),
                    0 5px 15px rgba(0, 0, 0, 0.3);
            }

            button:active {
                transform: translateY(0);
            }

            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .contract-result {
                background: rgba(0, 255, 0, 0.05);
                border: 1px solid #00ff00;
                border-radius: 10px;
                padding: 20px;
                margin-top: 20px;
                display: none;
            }

            .contract-result.show {
                display: block;
                animation: slideIn 0.3s ease;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .contract-label {
                color: #00ff00;
                margin-bottom: 10px;
                font-size: 0.9em;
            }

            .contract-address {
                background: rgba(0, 0, 0, 0.5);
                padding: 15px;
                border-radius: 5px;
                word-break: break-all;
                color: #00ffff;
                font-family: monospace;
                font-size: 0.9em;
                cursor: pointer;
                border: 1px solid #00ff00;
                transition: all 0.2s ease;
            }

            .contract-address:hover {
                background: rgba(0, 255, 0, 0.1);
                border-color: #00ffff;
            }

            .copy-hint {
                text-align: center;
                color: #666;
                font-size: 0.8em;
                margin-top: 8px;
            }

            .loading {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top-color: #00ffff;
                animation: spin 1s linear infinite;
                margin-left: 10px;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .error {
                background: rgba(255, 0, 0, 0.1);
                border: 1px solid #ff0000;
                border-radius: 5px;
                padding: 15px;
                margin-top: 20px;
                color: #ff6666;
                display: none;
            }

            .error.show {
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>AZTEC SWAPS</h1>

            <div class="balance-section">
                <div class="balance-label">CURRENT BALANCE (USDC)</div>
                <div class="balance-value" id="balance">--</div>
            </div>

            <div class="deploy-section">
                <div class="input-group">
                    <label for="amount">AMOUNT</label>
                    <input
                        type="number"
                        id="amount"
                        placeholder="Enter amount"
                        min="1"
                    />
                </div>
                <button id="deployBtn">GET PARTIAL NOTE ADDRESS</button>
            </div>

            <div class="contract-result" id="contractResult">
                <div class="contract-label">CONTRACT ADDRESS</div>
                <div
                    class="contract-address"
                    id="contractAddress"
                    onclick="copyToClipboard()"
                >
                    <!-- Address will be displayed here -->
                </div>
                <div class="copy-hint">Click to copy</div>
            </div>

            <div class="error" id="error"></div>
        </div>

        <script>
            const API_URL = "http://localhost:4000";

            // Fetch balance on page load
            async function fetchBalance() {
                try {
                    const response = await fetch(`${API_URL}/balance`);
                    const data = await response.json();
                    document.getElementById("balance").textContent =
                        data.balance;
                } catch (error) {
                    console.error("Error fetching balance:", error);
                    document.getElementById("balance").textContent = "ERROR";
                    showError(
                        "Failed to fetch balance. Make sure the API is running.",
                    );
                }
            }

            // Deploy escrow
            async function deployEscrow() {
                const amount = document.getElementById("amount").value;

                if (!amount || amount <= 0) {
                    showError("Please enter a valid amount");
                    return;
                }

                const btn = document.getElementById("deployBtn");
                const originalText = btn.textContent;
                btn.disabled = true;
                btn.innerHTML = 'DEPLOYING<span class="loading"></span>';

                try {
                    const response = await fetch(`${API_URL}/deploy_escrow`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ amount: parseInt(amount) }),
                    });

                    if (!response.ok) {
                        throw new Error("Deployment failed");
                    }

                    const data = await response.json();
                    document.getElementById("contractAddress").textContent =
                        data.contractAddress;
                    document
                        .getElementById("contractResult")
                        .classList.add("show");
                    document.getElementById("error").classList.remove("show");

                    // Refresh balance
                    fetchBalance();
                } catch (error) {
                    console.error("Error deploying escrow:", error);
                    showError(
                        "Failed to deploy escrow. Check console for details.",
                    );
                } finally {
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            }

            // Copy to clipboard
            async function copyToClipboard() {
                const address =
                    document.getElementById("contractAddress").textContent;
                try {
                    await navigator.clipboard.writeText(address);
                    const hint = document.querySelector(".copy-hint");
                    const originalText = hint.textContent;
                    hint.textContent = "Copied!";
                    hint.style.color = "#00ff00";
                    setTimeout(() => {
                        hint.textContent = originalText;
                        hint.style.color = "#666";
                    }, 2000);
                } catch (error) {
                    console.error("Failed to copy:", error);
                }
            }

            // Show error message
            function showError(message) {
                const errorDiv = document.getElementById("error");
                errorDiv.textContent = message;
                errorDiv.classList.add("show");
                setTimeout(() => {
                    errorDiv.classList.remove("show");
                }, 5000);
            }

            // Event listeners
            document
                .getElementById("deployBtn")
                .addEventListener("click", deployEscrow);

            // Initial balance fetch
            fetchBalance();

            // Auto-refresh balance every 5 seconds
            setInterval(fetchBalance, 5000);
        </script>
    </body>
</html>
